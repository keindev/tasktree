language: node_js
node_js:
    - '12'
    - '10'

cache: yarn

install: yarn
script:
    - yarn lint
    - yarn test
    - yarn build

jobs:
    include:
        - stage: npm release
          if: tag IS present
          node_js: '10'
          script: yarn build
          deploy:
              provider: npm
              email: '$NPM_EMAIL'
              api_key: '$NPM_TOKEN'
              skip_cleanup: true
              on:
                  tags: true

notifications:
    email:
        recipients:
            - kein@tagproject.ru
        on_success: change
        on_failure: always
